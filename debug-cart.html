<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Cart - Golden Fish</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        .debug-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .cart-display {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>è´­ç‰©è½¦è°ƒè¯•å·¥å…·</h1>
    
    <div class="debug-section">
        <h2>å½“å‰LocalStorageçŠ¶æ€</h2>
        <div id="localStorageStatus"></div>
        <button class="test-button" onclick="checkLocalStorage()">æ£€æŸ¥LocalStorage</button>
        <button class="test-button" onclick="clearCart()">æ¸…ç©ºè´­ç‰©è½¦</button>
    </div>
    
    <div class="debug-section">
        <h2>æµ‹è¯•æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦</h2>
        <button class="test-button" onclick="addTestItem()">æ·»åŠ æµ‹è¯•å•†å“</button>
        <button class="test-button" onclick="addComplexItem()">æ·»åŠ å¸¦é€‰é¡¹å•†å“</button>
        <div id="cartDisplay" class="cart-display"></div>
    </div>
    
    <div class="debug-section">
        <h2>æµ‹è¯•Checkoutæµç¨‹</h2>
        <button class="test-button" onclick="testCheckout()">æµ‹è¯•Checkout</button>
        <div id="checkoutResult"></div>
    </div>
    
    <div class="debug-section">
        <h2>æ§åˆ¶å°æ—¥å¿—</h2>
        <div id="consoleLog" style="background: #000; color: #0f0; padding: 10px; font-family: monospace; height: 200px; overflow-y: auto;"></div>
    </div>

    <script>
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const logDiv = document.getElementById('consoleLog');
            if (logDiv) {
                logDiv.innerHTML += args.join(' ') + '<br>';
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        };

        // åˆå§‹åŒ–è´­ç‰©è½¦
        let cart = JSON.parse(localStorage.getItem('goldenfish_cart') || '[]');
        
        function checkLocalStorage() {
            const statusDiv = document.getElementById('localStorageStatus');
            const cartData = localStorage.getItem('goldenfish_cart');
            const orderType = localStorage.getItem('goldenfish_order_type');
            const postcode = localStorage.getItem('goldenfish_postcode');
            
            statusDiv.innerHTML = `
                <div><strong>è´­ç‰©è½¦æ•°æ®:</strong> ${cartData || 'æ— '}</div>
                <div><strong>è®¢å•ç±»å‹:</strong> ${orderType || 'æ— '}</div>
                <div><strong>é‚®ç¼–:</strong> ${postcode || 'æ— '}</div>
                <div><strong>è´­ç‰©è½¦é•¿åº¦:</strong> ${cart.length}</div>
            `;
            
            console.log('ğŸ” LocalStorageæ£€æŸ¥:');
            console.log('Cart:', cartData);
            console.log('Order type:', orderType);
            console.log('Postcode:', postcode);
            
            updateCartDisplay();
        }
        
        function clearCart() {
            localStorage.removeItem('goldenfish_cart');
            localStorage.removeItem('goldenfish_order_type');
            localStorage.removeItem('goldenfish_postcode');
            cart = [];
            console.log('ğŸ—‘ï¸ è´­ç‰©è½¦å·²æ¸…ç©º');
            checkLocalStorage();
        }
        
        function addTestItem() {
            const testItem = {
                id: 'test1',
                name: 'Test Special Curry',
                price: 12.80,
                qty: 1
            };
            
            cart.push(testItem);
            localStorage.setItem('goldenfish_cart', JSON.stringify(cart));
            console.log('âœ… æ·»åŠ æµ‹è¯•å•†å“:', testItem);
            checkLocalStorage();
        }
        
        function addComplexItem() {
            const complexItem = {
                id: 'test2',
                name: 'Complex Duck Dish',
                price: 21.00,
                qty: 1,
                selectedVariant: { name: 'Half', price: 21.00 },
                selectedOptions: {
                    'Choose Sauce': { name: 'Plum Sauce', price: 0 },
                    'Extra Additions': [
                        { name: 'Extra Meat', price: 3.50 },
                        { name: 'Prawn Crackers', price: 1.50 }
                    ]
                }
            };
            
            cart.push(complexItem);
            localStorage.setItem('goldenfish_cart', JSON.stringify(cart));
            console.log('âœ… æ·»åŠ å¤æ‚å•†å“:', complexItem);
            checkLocalStorage();
        }
        
        function updateCartDisplay() {
            const displayDiv = document.getElementById('cartDisplay');
            if (cart.length === 0) {
                displayDiv.innerHTML = '<div class="error">è´­ç‰©è½¦ä¸ºç©º</div>';
                return;
            }
            
            let html = '<div class="success">è´­ç‰©è½¦å†…å®¹:</div>';
            let total = 0;
            
            cart.forEach((item, index) => {
                let itemTotal = item.price * item.qty;
                
                // è®¡ç®—é€‰é¡¹ä»·æ ¼
                if (item.selectedOptions) {
                    Object.entries(item.selectedOptions).forEach(([groupName, choice]) => {
                        if (Array.isArray(choice)) {
                            choice.forEach(c => itemTotal += c.price * item.qty);
                        } else {
                            itemTotal += choice.price * item.qty;
                        }
                    });
                }
                
                total += itemTotal;
                
                html += `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 5px 0;">
                        <strong>${item.name}</strong> x${item.qty} - $${itemTotal.toFixed(2)}
                        ${item.selectedVariant ? `<br>Size: ${item.selectedVariant.name}` : ''}
                        ${item.selectedOptions ? `<br>Options: ${JSON.stringify(item.selectedOptions)}` : ''}
                    </div>
                `;
            });
            
            html += `<div style="font-weight: bold; margin-top: 10px;">æ€»è®¡: $${total.toFixed(2)}</div>`;
            displayDiv.innerHTML = html;
        }
        
        function testCheckout() {
            const resultDiv = document.getElementById('checkoutResult');
            
            console.log('ğŸ”„ æµ‹è¯•Checkoutæµç¨‹');
            console.log('Cart length:', cart.length);
            console.log('Cart contents:', cart);
            
            if (cart.length === 0) {
                resultDiv.innerHTML = '<div class="error">è´­ç‰©è½¦ä¸ºç©ºï¼Œæ— æ³•checkout</div>';
                console.log('âŒ è´­ç‰©è½¦ä¸ºç©º');
                return;
            }
            
            // æ¨¡æ‹Ÿcheckoutæµç¨‹
            localStorage.setItem('goldenfish_order_type', 'delivery');
            localStorage.setItem('goldenfish_postcode', 'YO10 3BP');
            
            console.log('âœ… Checkoutæ•°æ®å·²ä¿å­˜');
            console.log('- Order type: delivery');
            console.log('- Postcode: YO10 3BP');
            
            resultDiv.innerHTML = `
                <div class="success">Checkoutæµ‹è¯•æˆåŠŸ!</div>
                <div>è´­ç‰©è½¦å•†å“æ•°: ${cart.length}</div>
                <div>è®¢å•ç±»å‹: delivery</div>
                <div>é‚®ç¼–: YO10 3BP</div>
                <div><a href="checkout.html" target="_blank">ç‚¹å‡»æµ‹è¯•Checkouté¡µé¢</a></div>
            `;
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥çŠ¶æ€
        window.onload = function() {
            checkLocalStorage();
        };
    </script>
</body>
</html>